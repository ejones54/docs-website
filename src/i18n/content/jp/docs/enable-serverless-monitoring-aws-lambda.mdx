---
title: Enable serverless monitoring for AWS Lambda
tags:
  - Serverless function monitoring
  - AWS Lambda monitoring
  - Enable Lambda monitoring
translate:
  - jp
redirects:
  - /docs/install-enable-new-relics-monitoring-aws-lambda
  - /docs/net-core-new-relic-monitoring-aws-lambda
  - /node/38236
  - /docs/serverless-function-monitoring/aws-lambda-monitoring/get-started/enable-new-relic-monitoring-aws-lambda
  - /docs/serverless-function-monitoring/aws-lambda-monitoring/get-started/enable-serverless-monitoring-aws-lambda
---

\[Test0129]ジョンを設定するには

<Callout variant="tip">
  \[TEST]AWS Lambda 向けのサーバーレスモニタリングは、Lambda 関数の綿密なパフォーマンスモニタリングを提供します。\[TEST]ハンドラーハンドラー [ハンドラーハンドラーハンドラーハンドラー](/docs/serverless-function-monitoring/aws-lambda-monitoring/enable-lambda-monitoring/enable-serverless-monitoring-using-lambda-layer).
</Callout>

[Serverless monitoring for AWS Lambda](/docs/introduction-new-relic-monitoring-aws-lambda) スモニタリングは、Lambda 関数の綿密なパフォーマンスモニタリングを提供します。この機能を有効にして使用する方法を学ぶために読んでください。

## Lambda監視のしくみ [#overview]

Lambdaモニタリングを有効にする前に、Lambda関数からNew Relicへのデータフローについて理解しておくとよいでしょう。

![AWS LambdaのNew Relic監視のアーキテクチャ - 図](./images/new-relic-lambda-monitoring-architecture.png "new-relic-lambda-monitoring-architecture.png")

Lambda関数からNew Relicへのデータフローを示した図表。

Lambdaモニタリングが有効な場合、次のようにデータはLambda関数からNew Relicに移動します。

1. \[TEST]**Lambda function**ドでインストゥルメントされています。
2. **CloudWatch** は、Lambdaのログデータを収集し、New Relicのlog-ingestion Lambdaに送信します。
3. **`log-ingestion` Lambda** はそのデータをNew Relicに送信します。

## 有効化の手順の概要 [#procedure-overview]

すでにNew Relicアカウントをお持ちでNode.jsまたはPythonを使用している場合は、自動化されたインストーラを[使用することをお勧めします](https://one.newrelic.com/launcher/lambda-nerdlets.launcher-lambda-onboarding?launcher=eyJ0aW1lUmFuZ2UiOnsiYmVnaW5fdGltZSI6bnVsbCwiZW5kX3RpbWUiOm51bGwsImR1cmF0aW9uIjoxODAwMDAwfSwiJGlzRmFsbGJhY2tUaW1lUmFuZ2UiOnRydWV9&pane=eyJuZXJkbGV0SWQiOiJsYW1iZGEtbmVyZGxldHMubGFtYmRhLW9uYm9hcmRpbmctY29ubmVjdGVkLWFjY291bnRzIn0=&cards%5B0%5D=eyJuZXJkbGV0SWQiOiJsYW1iZGEtbmVyZGxldHMubGFtYmRhLW9uYm9hcmRpbmctaW5zdHJ1Y3Rpb25zIn0=)。

<Callout variant="tip">
  \[TEST]この機能を使用すると、AWS の料金が発生する場合があります。\[TEST]ハンドラー [Lambda ハンドラーハンドラーハンドラー](/docs/serverless-function-monitoring/aws-lambda-monitoring/get-started/compatibility-requirements-aws-lambda-monitoring).
</Callout>

自動化された**not**用していない場合、次の手順を完了してモニタリングのセットアップを行います:

1. [Install our CLI tool](#cli) る（推奨）
2. [Connect AWS and New Relic](#connect-aws)（推奨）
3. [Enable instrumentation of your Lambda](#instrument-lambda)ルメンテーションを有効化する（推奨）
4. [Stream CloudWatch logs to New Relic](#stream-logs)ーミングする（推奨）

## \[TEST]Step 1. ハンドラー `newrelic-lambda-cli` ハンドラー [#cli]

\[TEST]AWS Lambda 向けのnewrelic-lambda-cliングは、ステップ3（オプシ、ステップ3（オプシ、ステップ3（オプシ、ステップ3（オプシ、ステップ3（オプシ

インストール前にその仕組みを理解したい場合は、ステップ2、ステップ3（オプション2）、そしてステップ4でCLIツールが[Step 2](#connect-aws), Step 3 ([option 2](#cli-layer)), and [Step 4](#stream-logs). また、CLIドキュメンテーション[CLI documentation on GitHub](https://github.com/newrelic/newrelic-lambda-cli)ることもできます。手動インストールを希望する場合は、ステップ2 AWSをNew[Step 2. Connect AWS to New Relic](#connect-aws).みます。

### CLIの要件

CLIツールを使用するには、以下が必要となります：

* Python 3.3 以降
* [AWS CLI](https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-install.html)
* \[TEST]ハンドラーハンドラー [admin](/docs/accounts/accounts/roles-permissions/users-roles#roles) ハンドラーハンドラー[Add-on role](/docs/accounts/accounts/roles-permissions/add-roles-permissions).
* AWSアカウントには、IAMリソース（ロールとポリシー）およびLambda関数を作成する権限が必要です。 こうしたリソースは、CloudFormationスタックを使用して作成されるため、このスタックを作成する権限が必要となります。 カスタム方針の設定を含む権限の詳細に関しては、この折り畳みを表示してください:

<CollapserGroup>
  <Collapser
    id="aws-permissions"
    title="AWS権限の詳細"
  >
    ```
    Resource: *
    Actions:
        "cloudformation:CreateChangeSet",
        "cloudformation:CreateStack",
        "cloudformation:DescribeStacks",
        "cloudformation:ExecuteChangeSets",
        "iam:AttachRolePolicy",
        "iam:CreateRole",
        "iam:GetRole",
        "iam:PassRole",
        "lambda:AddPermission",
        "lambda:CreateFunction",
        "lambda:GetFunction",
        "logs:DeleteSubscriptionFilter",
        "logs:DescribeSubscriptionFilters",
        "logs:PutSubscriptionFilter"
        "s3:GetObject"
        "serverlessrepo:CreateCloudFormationChangeSet"

    Resource: "arn:aws:serverlessrepo:us-east-1:463657938898:applications/NewRelic-log-ingestion"
    Actions:
    "serverlessrepo:CreateCloudFormationTemplate"
    "serverlessrepo:GetCloudFormationTemplate"

    ```

    <Callout variant="caution">
      CLIの実行で使用するAWSアカウントに、これらすべての権限があることを確認してください。
    </Callout>

    AWSアカウント権限に制限があり、CLIを使用できない場合は、手動管理されたIAMポリシーを使用するオプションもあります。 このポリシーは、最低でも以下の権限を必要とします:

    ```

    Resource: "\*"
    Action:  
     "cloudwatch:GetMetricStatistics"
    "cloudwatch:ListMetrics"
    "cloudwatch:GetMetricData"
    "lambda:GetAccountSettings"
    "lambda:ListFunctions"
    "lambda:ListAliases"
    "lambda:ListTags"
    "lambda:ListEventSourceMappings"

    ```

    \[TEST]AWS Lambda 向けのサーバーレスモニタリングは\[TEST]ハンドラーハンドラーハンドラー `ReadOnlyAccess` ハンドラー [ハンドラー AWS to infrastructure ハンドラー](/docs/integrations/amazon-integrations/get-started/connect-aws-infrastructure#connect).
  </Collapser>
</CollapserGroup>

### CLIインストレーション [#cli-install]

以下の方法で、CLIツールをインストールしてください:

1. 必ず、New RelicとAWSアカウントの両方の必要な権限が[あることを確](#cli)認してください。
2. コマンドラインから、以下を実行してください。

```

pip install newrelic-lambda-cli

```

<Callout variant="important">
  Python 2.7をインストール済みの場合は、上記コマンド`pip3`用する必要があるかもしれません。CLIを使用するには、Python 3.3以上が必要です。
</Callout>

## \[TEST]Step 2. ハンドラーハンドラー [#connect-aws]

<Callout variant="important">
  Lambdaモニタリングを有効にするには、このステップならびにステップ3～4を実施する必要があります。
</Callout>

このステップでは、AWSをNew Relicに接続することで、インストゥルメントされたデータをNew Relicに送信する`newrelic-log-ingestion` Lambda関数を作成します。CLIツールを使用するか、手動でステップを進めることができます。

### CLIツールを使用する [#use-cli]

CLIを使用すると、オプションのステップと必須のステップがそれぞれ1つずつあります：

1. 複数のAWSプロファイルまたは複数のリージョンを使用している場合は、AWSの環境変数を設定すると良いかもしれません:

<CollapserGroup>
  <Collapser
    id="aws-env-variables"
    title="AWSの環境変数に関する説明"
  >
    **ジョンの設**リー定リージョンを設定するには、この環境変[数を](https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-envvars.html)使用してデフォルトのリージョンをオーバーライドしてください:

    ```

    export AWS_DEFAULT_REGION=MY_REGION # us-west-2, for example
    ```

    CLIツールもまた、これを`--aws-region`.経由でコマンドごとにパスできます。**\[Test0129]ジョンを設定するには**

    AWSプロファイルが複数あり、デフォルトを使用しない場合、`AWS_PROFILE` 環境変数[を使用して](https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-envvars.html)別のプロファイル名を設定します。プロファイルが適切に設定されていることを確認します（デフォルトの地域を含む）。例:

    ```
    export AWS_PROFILE=MY_PROFILE
    ```
  </Collapser>
</CollapserGroup>

2. [CLI tool](#cli):を使用して、以下のコマンドを実行してください:

```
newrelic-lambda integrations install --nr-account-id YOUR_ACCOUNT_ID \
--linked-account-name YOUR_LINKED_ACCOUNT_NAME \
--nr-api-key YOUR_NEW_RELIC_USER_KEY
```

このコマンドは:

* ご使用のAWSアカウントをNew Relicに接続します。
* インストゥルメントされたデータをNew Relicに送信する、`newrelic-log-ingestion` Lambdaをインストールします。

さらに詳しく:

* これは、米国リージョンをデフォルト設定にします。\[TEST]ハンドラー [EU region](https://docs.newrelic.com/docs/using-new-relic/welcome-new-relic/get-started/introduction-eu-region-data-center), ハンドラー`--nr-region "eu"`.\[TEST]複数のAWSリージョンで引数をインストゥルメントしている場合、このコマンドは `--aws-region` 引数を使用して各リージョンで実行する必要があります。
* YOUR_LINKED_ACCOUNT_NAME は、New Relic にリンクする新しいAWSアカウントまたは AWS Lambda モニタリング インテグレーションを設定するときにリンクしたAWSアカウントの名前です。
* \[TEST]AWS Lambda 向けのサーバーレスモニタリングは [user key](https://docs.newrelic.com/docs/apis/get-started/intro-apis/types-new-relic-api-keys#user-api-key)
* APIキーおよびその他の引数に関しては、[Lambdaモニタリ](https://github.com/newrelic/newrelic-lambda-cli#install-integration)ングGitHubリポジトリを参照してください。

### 手動の手順 [#manual-connect-to-aws]

[CLIツー](#cli)ルが実行する手動の手順は以下のとおりです:

<CollapserGroup>
  <Collapser
    id="manual-connect"
    title="AWSをNew Relicに接続する"
  >
    `newrelic-lambda integration`コマンドは、Lambdaを含むAWSアカウントをNew Relicに接続します。すでにA[WSインテ](/docs/integrations/amazon-integrations/aws-integrations-list)グレーションの1つをインストールしている場合、アカウントをNew Relicにリンクしてください。それでこのセクションを省略できます。

    この接続を手動で確立するには、[AWSをInfrastructureの](/docs/integrations/amazon-integrations/get-started/connect-aws-infrastructure#connect)モニタリングに接続するの指示に従ってください。
  </Collapser>

  <Collapser
    id="manual-nr-lambda"
    title="log-ingestion Lambdaを設定"
  >
    `newrelic-lambda integration`コマンドは、`newrelic-log-ingestion` Lambdaを設定します。このLambdaは、Lambda関数が生成したログを取得し、そのログをNew Relicにプッシュします。これを手動で行っている場合、このLambdaを希望の地域について設定する必要があります。

    CLIはデフォルトで、Lambdaをすべての地域で設定します。

    [Lambdaを手動で設定するには、AWSサー](https://aws.amazon.com/serverless/serverlessrepo/ "新しいウィンドウにリンクが開きます。")バーレスアプリケーションリポジトリを使用します。このリポジトリに、`newrelic-log-ingestion` Lambdaが保存されます。このリポジトリは、サーバーレスコミュニティの開発者や会社、パートナーが公開したサーバーレスアプリケーションをまとめたものです。このリポジトリを使用して、開発者はLambda関数コードを顧客と共有し、顧客は対応するアプリケーションのLambda関数を検索してデプロイできます。各アプリケーションは、使[用し](https://github.com/awslabs/serverless-application-model "新しいウィンドウにリンクが開きます。")たAWSリソースを定義するAWSサーバーレスアプリケーションモデル（SAM）テンプレートでパッケージ化されます。

    AWSサーバーレスアプリケーションリポジトリを使用してLambdaを手動で設定するには：

    1. AWSコンソールから**Lambdaセクショ**ンに移動し、関数を作成を選択し、サーバ**ーレスアプ**リケーションリポジトリを選択します。
    2. `newrelic`を検索し、`newrelic-log-ingestion` Lambdaを検索します。[Lambdaドキュメント](https://serverlessrepo.aws.amazon.com/applications/arn:aws:serverlessrepo:us-east-1:463657938898:applications%7ENewRelic-log-ingestion "新しいウィンドウにリンクが開きます。")の指示に従い、デプロイします。[SAMテンプレ](https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-template-basics.html "新しいウィンドウにリンクが開きます。")ートがLambdaを構築します。
    3. [AWSコンソールの](https://docs.aws.amazon.com/lambda/latest/dg/env_variables.html)環境変数セクションで、`LICENSE_KEY`環境変数を[New Relicライセン](/docs/accounts/install-new-relic/account-setup/license-key)スキーに設定します。複数のアカウントまたはマスターとサブアカウントのヒエラルキーがある場合は、必ずAWSに接続したものと同じアカウントに相当するライセンスキーを使用してください。
    4. \[TEST]ージョンで引数をインストージョンで引数をインスト `LOGGING_ENABLED` ージョンで引数をインスト `true`.\[TEST]ージョンで引数をインスト [Stream all logs](#stream-logs).
  </Collapser>
</CollapserGroup>

## \[TEST]AWS Lambda 向けのサーバーレスモニタリングは [#instrument-lambda]

このステップによってお客様のLambda機能のインストゥルメンテーションが可能になり、詳細なモニタリングとアラート機能ができるようになります。 当社のインストゥルメンテーションは、Lambdaのパフォーマンスへの影響を最小限に抑えられるように設計されています。

Node.jsまたはPythonを使用している場合は、最初の2つのオプションが推奨されます。

<CollapserGroup>
  <Collapser
    id="serverless-plugin"
    title="[TEST]AWS Lambda 向けのサーバーレスモニタリングは"
  >
    **要件**

    * Node.jsおよびPythonにおいてのみ利用可能です。他の言語の場合、手動インストゥルメ[ンテーションを参](#manual-instrument)照してください。

    * [Serverless Frameworkバ](https://github.com/serverless/serverless/)ージョン1.34.0またはそれ以上。

      **機能**

      （上記の）要件に適合している場合、当社のServerless Frameworkプラグインを使用できます。これによって、コードの変更が要求されることなくAWS Lambda Layerを機能に追加できます。

    * Node.jsおよびPythonランタイムのサポート

    * Lambdaインストゥルメンテーションを有効にするには、コードの変更は不要です。

    * 単一レイヤを用いてAPMエージェント機能を有効化

    * CloudWatchサブスクリプションフィルターを自動で構成

    * 再デプロイに役立つコードベースにレイヤーを取得します

      **インストール**

      当社のServerless Frameworkプラグインをインストールするには：

    1. インストールオプションを選択してください：

       * \[TEST]AWS Lambda 向けのサーバーレスモニタリングは

    ```
    npm install --save-dev serverless-newrelic-lambda-layers
    ```

    * \[TEST]AWS Lambda 向けのサーバーレスモニタリングは

    ```
    yarn add --dev serverless-newrelic-lambda-layers
    ```

    2. プラグインをお客様の`serverless.yml`へ追加してください：

    ```
    plugins:
      - serverless-newrelic-lambda-layers
    ```

    3. お客様のアカ[ウントID](/docs/accounts/install-new-relic/account-setup/account-id)を入手し、`serverless.yml`に入力します：

    ```
    custom:
      newRelic:
          accountId: YOUR_ACCOUNT_ID
    ```

    4. それをデプロイしてください：

    ```
    sls deploy
    ```

    ステ[ップ4 CloudWatchログを](/docs/serverless-function-monitoring/aws-lambda-monitoring/get-started/enable-new-relic-monitoring-aws-lambda#stream-logs)設定するをスキップできます。これは、Serverless Frameworkのプラグインによってディプロイ時に自動的に完了します。

    次のステップに進んでく[ださい](#find-data)。
  </Collapser>

  <Collapser
    id="cli-layer"
    title="[TEST]AWS Lambda 向けのサーバーレスモニタリングは"
  >
    <Callout variant="important">
      Node.jsおよびPythonにおいてのみ利用可能です。他の言語の場合、手動インストゥルメ[ンテーションを参](#manual-instrument)照してください。
    </Callout>

    [Serverless Framework](#serverless-plugin)をお持ちでなく、関数を頻繁に再デプロイする予定がない場合は、CLIを使用してLambda Layer を手動で追加できます。

    1. まだの場合は、CLIをインストールしてください:

    ```
    pip install newrelic-lambda-cli
    ```

    2. 利用可能な関数を一覧表示：

    ```
    newrelic-lambda functions list
    ```

    オプション`-f not-installed`を渡し、どの関数がまだインストゥルメントされていないかを一覧表示します。レイヤーを関数に追加：

    ```
    newrelic-lambda layers install --function FUNCTION_NAME --nr-account-id NEW_RELIC_ACCOUNT_ID
    ```

    次に、[CloudWatchを設定してログをNew Relic](#stream-logs)に送信します。
  </Collapser>

  <Collapser
    id="manual-layer"
    title="[TEST]AWS Lambda 向けのサーバーレスモニタリングは"
  >
    <Callout variant="important">
      Node.jsおよびPythonにおいてのみ利用可能です。他の言語の場合、手動インストゥルメ[ンテーションを参](#manual-instrument)照してください。
    </Callout>

    [Serverless Framework](#serverless-plugin)をお持ちでない場合、Lambda Layerを手動で追加できます。

    1. お客様[のランタイ](https://nr-layers.iopipe.com/)ムとリージョンに一致するレイヤを検索します。

    2. 最新バージョンのAmazonリソースネーム（ARN）をコピーし、お客様の機能のAWS Lambdaコンソールにこれを追加します。

    3. お客様の機能向けのコンソールにおいて新しく追加されたレイヤを示す機能ハンドラを更新します。

       * \[TEST]AWS Lambda 向け`newrelic_lambda_wrapper.handler`
       * \[TEST]AWS Lambda 向け`newrelic-lambda-wrapper.handler`

    4. これらの環境変数をLambdaコンソールに追加します。

       * \[TEST]`NEW_RELIC_ACCOUNT_ID`バーレスモニタリングは[account ID](/docs/accounts/install-new-relic/account-setup/account-id)
       * \[TEST]AWS L`NEW_RELIC_LAMBDA_HANDLER`タリングは

       Node 8を使用していて、`Lambda can't find file` エラーメッセージが表示される場合は、次の折り畳みを表示してください:

       <CollapserGroup>
         <Collapser
           id="node-8-error"
           title="Node 8の &quot;can't find file&quot; エラーに関するトラブルシューティング"
         >
           \[TEST]AWS Lambda 向けのサーバ`Lambda can't find the file newrelic-lambda-wrapper.js` ーバーレスモニタリングは `NPM_PATH` for the `newrelic-lambda` ーバーレスモニタリングは `/opt/nodejs/node_modules`.以下のステップを経て、問題を修正してください:

           * プロジェクトルートで `newrelic-wrapper-helper.js` スクリプトを作成します。
           * このスクリプトは、`module.exports = require('newrelic-lambda-wrapper')`;でなくてはいけません。（このスクリプトには、以上の内容のみを含める。）
           * レイヤー宣言のハンドラーを` newrelic-lambda-wrapper.handler`にアップデートします。
         </Collapser>
       </CollapserGroup>

       次に、[CloudWatchを設定してログをNew Relic](#stream-logs)に送信します。
  </Collapser>

  <Collapser
    id="manual-instrument"
    title="[TEST]AWS Lambda 向けのサーバーレスモニタリングは"
  >
    前述のオプション のいずれも[機能しな](#instrument-lambda)い場合、Lambdaコードを手動でインストゥルメントできます。言語を選択してください：

    <Collapser
      id="go"
      title="Go"
    >
      Go-language Lambdaをインストゥルメントするには：

      1. Goエージェントパッケージをダウンロードし、関数と同じディレクトリに置きます。
      2. \[TEST]AWS Lambda `go get -u github.com/newrelic/go-agent`.
      3. Lambdaコードで、コンポーネントをインポートし、アプリケーションを作成し、Lambdaの起動方法を更新します。インストゥルメントされた[Lambdaの例については、GitHub](https://github.com/newrelic/go-agent/blob/master/_integrations/nrlambda/example/main.go)リポジトリをご覧ください。
      4. \[TEST]AWS Lambda 向けのサーバーレスモニタリングは[custom events](https://docs.newrelic.com/docs/using-new-relic/welcome-new-relic/getting-started/glossary#custom-event) [`RecordCustomEvent` API](https://docs.newrelic.com/docs/agents/go-agent/features/create-custom-events-insights-go).例：

      ```
      func handler(ctx context.Context) {
      if txn := newrelic.FromContext(ctx); nil != txn {
        txn.Application().RecordCustomEvent("MyEvent", map[string]interface{}{
          "zip": "zap",
        })
      }
      fmt.Println("hello world!")
      }
      ```

      5. Lambda関数を構築して圧縮し、AWSにアップロードします。

      <Collapser
        id="zip-upload"
        title="圧縮とアップロートについての推奨"
      >
        Lambdaの圧縮とアップロードについての推奨は次のとおりです。

        1. Linuxでの実行用のバイナリを構築します。これにより、`main`と呼ばれるバイナリファイルが作成されます。次のものを使用できます。

        ```
        $ GOOS=linux go build -o main
        ```

        2. 次のものを使用して、バイナリをデプロイパッケージに圧縮します。

        ```
        $ zip deployment.zip main
        ```

        3. AWS LambdaコンソールまたはAWS CLIのいずれかを使用して、zipファイルをAWSにアップロードします。（バイナリ構築の間に付けられた名前と同じにするため）ハンドラーの名前を`main`にします。
      </Collapser>

      6. 次の環境変数はLambdaモニターの機能には不要ですが、Lambda機能をディストリビューティッド（分散）トレーシングに含める場合は必要です。ディストリビューティッ[ド（分散）トレ](/docs/apm/distributed-tracing/getting-started/introduction-distributed-tracing)ーシングを有効にするには、AWSコンソールで次の[環境変](https://docs.aws.amazon.com/amplify/latest/userguide/environment-variables.html)数を設定します。

         * \[TEST]`NEW_RELIC_ACCOUNT_ID`. Your [account ID](/docs/accounts/install-new-relic/account-setup/account-id).ニタリングは
         * `NEW_RELIC_TRUSTED_ACCOUNT_KEY.`これは、お客様のアカウ[ントID](/docs/accounts/install-new-relic/account-setup/account-id)でもあります。アカウントがサブアカウントの場合、これはroot/親アカウントのアカウントIDとなります。

      7. \[TEST]AWS Lambda 向けのサーバーレスモニタリングは [Go agent logging](/docs/agents/go-agent/configuration/go-agent-logging).

      8. 少なくとも1回Lambdaを呼び出します。 これにより、CloudWatchロググループが作成されます。次のステップを行うには、このグループが必要です。

         ラッパーはLambda実行についてのデータを収集し、JSONメッセージを生成し、CloudWatchログに記録します。次に、[CloudWatchを設定してそのログをNew Relic](#stream-logs)に送信します。
    </Collapser>

    <Collapser
      id="java"
      title="Java"
    >
      JavaでのAWS Lambdaのモニタリングでは、[APM Javaエ](/docs/agents/java-agent)ージェントは使用しません。代わりに、次の2つのOpenTracing依存関係を使用します。

      * \[TEST]AWS Lambda 向 [OpenTracing](https://github.com/opentracing) iスモニタリングは

      * \[TEST]AWS Lambda 向けのサーバーレスモニタリングはスパンやエラーイベント、トランザクションイベント、エラートレースを生成し、ディストリビューティッド（分散）トレーシングをサポートします。

        <Callout variant="tip">
          **サポート対象の OpenTracing バージョン**

          * **OpenTracing 0.31.0**:

            * \[TEST]スモニタリングは[com.newrelic.opentracing:newrelic-java-lambda:1.1.1](https://search.maven.org/artifact/com.newrelic.opentracing/newrelic-java-lambda/1.1.1/jar)
            * \[TEST]向けのサーバ[com.newrelic.opentracing:java-aws-lambda:1.0.0](https://search.maven.org/artifact/com.newrelic.opentracing/java-aws-lambda/1.0.0/jar)

          * **OpenTracing 0.32.0, 0.33.0**:

            * \[TEST]けのサーバーレスモニタリングは[com.newrelic.opentracing:newrelic-java-lambda:2.1.1](https://search.maven.org/artifact/com.newrelic.opentracing/newrelic-java-lambda)
            * \[TEST]けのサーバーレスモニタリングは[com.newrelic.opentracing:java-aws-lambda:2.1.0](https://search.maven.org/artifact/com.newrelic.opentracing/java-aws-lambda)
        </Callout>

        Java Lambdaをインストゥルメントするには：

      1. プロジェクトの`build.gradle`ファイルに、OpenTracing AWS Lambda TracerとAWS Lambda OpenTracing SDK依存関係を含めます：

      ```
      dependencies {
            compile("com.newrelic.opentracing:java-aws-lambda:2.1.0")
            compile("com.newrelic.opentracing:newrelic-java-lambda:2.1.1")
            compile("io.opentracing:opentracing-util:0.33.0")
      }
      ```

      2. されたようにAWS Lambda `RequestHandler`インタフェー[Java Lambdaの例に](https://github.com/newrelic/newrelic-lambda-tracer-java#usage)示スを実装し、`doHandleRequest`メソッドを上書きします。

      3. \[TEST]AWS Lambda 向けのサーバーレスモニタリングは `doHandleRequest` モニタリング `LambdaTracing.instrument(...)`このAPIでは、Lambda関数のビジネスロジックも定義します。

      4. されたように、`LambdaTracer.INSTANCE`をOpenTracing Globalト[Java Lambdaの例に](https://github.com/newrelic/newrelic-lambda-tracer-java#usage)示レーサーとして登録します。

      5. [ZIPデプロイパッケージを](https://docs.aws.amazon.com/lambda/latest/dg/java-package.html)作成し、AWS Lambdaにアップロードします。または、その他の方法でディプロイします。

      6. AWS Lambdaコンソールで、ハンドラーを設定します。[Java Lambdaの例で](https://github.com/newrelic/newrelic-lambda-tracer-java#usage)、ハンドラーは`com.handler.example.MyLambdaHandler::handleRequest`となります。`handleRequest`が前提となっているため、also use `com.handler.example.MyLambdaHandler`も使用できます。

      7. 以下の [AWSコンソール環境変数は](https://docs.aws.amazon.com/amplify/latest/userguide/environment-variables.html)、Lambda機能をディストリビューティッド（分散）ト[レーシン](/docs/apm/distributed-tracing/getting-started/introduction-distributed-tracing)グに含める場合は必要です。これが推奨されます。

         * \[TEST]`NEW_RELIC_ACCOUNT_ID`. Your [account ID](/docs/accounts/install-new-relic/account-setup/account-id).ニタリングは
         * `NEW_RELIC_PRIMARY_APPLICATION_ID`.これは、お客様のアカウント[account ID](/docs/accounts/install-new-relic/account-setup/account-id).す。
         * `NEW_RELIC_TRUSTED_ACCOUNT_KEY`.これは、お客様のアカウント[account ID](/docs/accounts/install-new-relic/account-setup/account-id).ります。アカウントがサブアカウントの場合、これはroot/親アカウントのアカウントIDである必要があります。

      8. \[TEST]AWS Lambda 向けのサーバーレスモニタリングは `NEW_RELIC_DEBUG` is `true`.

      9. 少なくとも1回Lambdaを呼び出します。 これにより、CloudWatchロググループが作成されます。次のステップを行うには、このグループが必要です。

         ラッパーはLambda実行についてのデータを収集し、JSONメッセージを生成し、CloudWatchログに記録します。次に、[CloudWatchを設定してそのログをNew Relic](#stream-logs)に送信します。

         次のような一般的な使用例を示す完全なプロジェクト[のAWS Lambdaディスト](https://github.com/newrelic/newrelic-lambda-tracer-java/tree/main/examples/distributed-tracing-example)リビューティッド（分散）トレーシングの例をご覧ください。

      * Lambda関数間のディストリビューティッド（分散）トレーシング
      * 手作業でのスパン作成（別名カスタムインストゥルメンテーション）
      * 外部コールのトレース
      * カスタムアトリビュート（別名タグ）のスパンへの追加
    </Collapser>

    <Collapser
      id="net-core"
      title=".NET Core"
    >
      .NET CoreベースのAWS Lambda関数の監視は弊社の標準的[.NET Core APMエ](/docs/agents/net-agent/installation/compatibility-requirements-net-core-agent)ージェントを使用しません。代わりに、NuGetパッケージを使用します。

      ご利用の.NET Core Lambdaをインストゥルメントするには、

      1. ご自分のLambda関数プロジェクトで、`NewRelic.OpenTracing.AmazonLambda.Tracer `NuGetパッケージをインストールしてください。

         \[TEST]AWS Lambda 向けのサーバーレス`NewRelic.OpenTracing.AmazonLambda.Tracer`a 向けのサーバーレスモニタリングof `Amazon.Lambda.APIGatewayEvent`環境がすでに下位バージョンの Amazon.Lambda.APIGatewa `Amazon.Lambda.APIGatewayEvent`いる場合、New Relic パッケージは Syste`System.MissingMethodException` .エラーを生成する可能性があります。

      2. NuGetパッケージとOpenTracingユーティリティをインポートします:

      ```
      using OpenTracing.Util;
      using NewRelic.OpenTracing.AmazonLambda;
      ```

      3. 例で示されたように、ご利用の機能を以下のようにインストゥルメントする。

      ```
      public class Function
      {

        static Function()
        {
          // Register The NewRelic Lambda Tracer Instance
          GlobalTracer.Register(NewRelic.OpenTracing.AmazonLambda.LambdaTracer.Instance);
        }

        public object FunctionWrapper(ILambdaContext context)
        {
          // Instantiate NewRelic TracingWrapper and pass your FunctionHandler as
          // an argument
          return new TracingRequestHandler().LambdaWrapper(FunctionHandler, context);
        }

        /// <summary>
        /// A simple function that takes a string and does a ToUpper
        /// </summary>
        /// <param name="input"></param>
        /// <param name="context"></param>
        /// <returns></returns>
        public object FunctionHandler(ILambdaContext context)
        { ... }

      }
      ```

      <Callout variant="tip">
        ハンドラーハンドラー `FunctionWrapper` ハンドラーハンドラー `FunctionHandler`.
      </Callout>

      ハンドラー関数がタスクを返す場合、Lambdaラッパーは返されたタスクを完了するまでブロックします。そのため、持続時間を計測でき、例外がある場合それを把握できます。ハンドラーハンドラーハンドラー `APIGatewayProxyFunction`.

      例については、以下をご覧ください。

      <CollapserGroup>
        <Collapser
          id="net-handler-returns-task-example"
          title="非同期ハンドラー関数"
        >
          ```
          public override Task<int> FunctionHandlerAsync(ILambdaContext lambdaContext)
          {
          // This call will block by calling task.Result 
          Task<int> task = new TracingRequestHandler().LambdaWrapper(
                                  ActualFunctionHandlerAsync, lambdaContext);
          return task;
          }

          public Task<APIGatewayProxyResponse> ActualFunctionHandlerAsync(ILambdaContext
          lambdaContext)
          { // Function can make other async operations here
          ...
          }

          ```
        </Collapser>

        <Collapser
          id="net-handler-inherit-apigatewayproxyfunction"
          title="APIGatewayProxyFunctionからの継承"
        >
          ```

          public class LambdaFunction : APIGatewayProxyFunction
          {
          static LambdaFunction()
          {
          // Register The NewRelic Lambda Tracer Instance
          OpenTracing.Util.GlobalTracer.Register(NewRelic.OpenTracing.AmazonLambda.LambdaTracer.Instance);
          }

          public override Task<APIGatewayProxyResponse> FunctionHandlerAsync(APIGatewayProxyRequest request, ILambdaContext lambdaContext)
          {
          Task<APIGatewayProxyResponse> task = new TracingRequestHandler().LambdaWrapper(ActualFunctionHandlerAsync, request, lambdaContext);
          return task;
          }

          public Task<APIGatewayProxyResponse> ActualFunctionHandlerAsync(APIGatewayProxyRequest request, ILambdaContext lambdaContext)
          {
          return base.FunctionHandlerAsync(request, lambdaContext);
          }
          }

          ```
        </Collapser>
      </CollapserGroup>

      4. ハンドラーハンドラーハンドラーハンドラーハンドラー, [distributed tracing](/docs/apm/distributed-tracing/getting-started/introduction-distributed-tracing) ハンドラーハンドラーハンドラーハンドラー.SQSまたはSNSにおいてディストリビューティッド（分散）トレーシングを有効にするには、このステップの項目を完了させるとともに、これに続くステップにおいて環境変数を設定する必要があります。

         <Callout variant="important">
           SQSおよびSNSにおいてディストリビューティッド（分散）トレーシングのサポートを有効にすると、SQSとSNSの両方において自動インストゥルメンテーションが無効になり、それらのインストゥルメントに向けてこれらのwrapperの使用が要求されることになります。
         </Callout>

         1. NEW_RELIC_USE_DT_WRAPPER環境変数をtrueに設定してください。`NEW_RELIC_USE_DT_WRAPPER` ハンドラー `true`.
         2. SQSおよびSNSコールをインストゥルメントするには、規定のwrapperを使用する必要があります。

      <CollapserGroup>
        <Collapser
          id="net-dt-sqs"
          title="SQS Wrapperの使用"
        >
          SQS wrapperは以下の手法のラッピングをサポートします。

          * Amazon.SQS.AmazonSQSClient.SendMessageAsync(...)

          * Amazon.SQS.AmazonSQSClient.SendMessageBatchAsync(...)

            例

          ```

          // SQS Client
          AmazonSQSClient client = new AmazonSQSClient("AWS_SECRET_ACCESS_KEY", AWS_REGION);

          // SendMessageRequest
          SendMessageRequest sendRequest = new SendMessageRequest("QUEUE_URI_STRING", "An SQS Message");
          Task<SendMessageResponse> responseOne = SQSWrapper.WrapRequest(client.SendMessageAsync, sendRequest);

          // String-based
          Task<SendMessageResponse> responseTwo = SQSWrapper.WrapRequest(client.SendMessageAsync, "QUEUE_URI_STRING", "Another SQS Message");

          // SendMessageBatchRequest
          List<SendMessageBatchRequestEntry> batchEntries = new List<SendMessageBatchRequestEntry>();
          batchEntries.Add(new SendMessageBatchRequestEntry("id1", "First SQS Message"));
          batchEntries.Add(new SendMessageBatchRequestEntry("id2", "Second SQS Message"));
          batchEntries.Add(new SendMessageBatchRequestEntry("id3", "Third SQS Message"));
          SendMessageBatchRequest sendBatchRequest = new SendMessageBatchRequest(QUEUE_URI, batchEntries);
          Task<SendMessageBatchResponse> response = SQSWrapper.WrapRequest(client.SendMessageBatchAsync, sendBatchRequest);

          // SendMessageBatchRequestEntry List
          List<SendMessageBatchRequestEntry> moreBatchEntries = new List<SendMessageBatchRequestEntry>();
          batchEntries.Add(new SendMessageBatchRequestEntry("id4", "Fourth SQS Message"));
          batchEntries.Add(new SendMessageBatchRequestEntry("id5", "Fifth SQS Message"));
          batchEntries.Add(new SendMessageBatchRequestEntry("id6", "Sixth SQS Message"));
          Task<SendMessageBatchResponse> response = SQSWrapper.WrapRequest(client.SendMessageBatchAsync, moreBatchEntries);

          ```
        </Collapser>

        <Collapser
          id="net-dt-sns"
          title="SNS Wrapperの使用"
        >
          SNS wrapperは以下の手法のラッピングをサポートします。

          * Amazon.SimpleNotificationService.AmazonSimpleNotificationServiceClient.PublishAsync(...)

          例

          ```

          // SNS Client
          AmazonSimpleNotificationServiceClient client = new Amazon.SimpleNotificationService.AmazonSimpleNotificationServiceClient("AWS_SECRET_ACCESS_KEY", AWS_REGION);

          // PublishRequest - Phone Number
          PublishRequest phonePublishRequest = new PublishRequest();
          phonePublishRequest.PhoneNumber = +1XXX5555100;
          phonePublishRequest.Message = "An SNS Message for phones";
          Task<PublishResponse> phoneResponse = SNSWrapper.WrapRequest(client.PublishAsync, phonePublishRequest);

          // PublishRequest - ARN
          PublishRequest publishRequest = new PublishRequest("TOPIC_ARN", "An SNS Message");
          Task<PublishResponse> publishResponse = SNSWrapper.WrapRequest(client.PublishAsync, publishRequest);

          // String-based without subject
          Task<PublishResponse> ResponseOne = SNSWrapper.WrapRequest(client.PublishAsync, "TOPIC_ARN", "Another SNS Message");

          // String-based with subject
          Task<PublishResponse> ResponseTwo = SNSWrapper.WrapRequest(client.PublishAsync, "TOPIC_ARN", "Yet Another SNS Message", "A Subject");

          ```
        </Collapser>
      </CollapserGroup>

      5. 次の環境変数はLambdaモニターの機能には不要ですが、Lambda機能をディストリビューティッド（分散）トレーシングに含める場合は必要です。ハンドラー[distributed tracing](/docs/apm/distributed-tracing/getting-started/introduction-distributed-tracing),ハンドラーハンドラーハンドラー [AWS Lambda console](https://docs.aws.amazon.com/lambda/latest/dg/env_variables.html):

         * \[TEST]`NEW_RELIC_ACCOUNT_ID`: The [account ID](/docs/accounts/install-new-relic/account-setup/account-id)バーレスモニタリングは
         * \[TEST]AWS Lambda 向けのサー`NEW_RELIC_TRUSTED_ACCOUNT_KEY`: 向けのサ [account ID](/docs/accounts/install-new-relic/account-setup/account-id). レスモニタリングはアカウントがサブアカウントの場合、これはroot/親アカウントのアカウントIDである必要があります。

      6. ラッパー関数 (上記の例では`FunctionWrapper`)が関数ハンドラーとして設定されていることを確認してください。

      7. 少なくとも1回Lambdaを呼び出します。 これにより、CloudWatchロググループが作成されます。次のステップを行うには、このグループが必要です。

         ラッパーはLambda実行についてのデータを収集し、JSONメッセージを生成し、CloudWatchログに記録します。次に、[CloudWatchを設定してそのログを](#stream-logs)New Relicに送信します。
    </Collapser>

    <Collapser
      id="node"
      title="Node.js"
    >
      Node.js Lambdaをインストゥルメントするには：

      1. Node.jsエージェントパッケージをダウンロードし、関数と同じディレクトリに配置し、エージェントが`node_modules`ディレクトリで依存関係としてインストールされていることを確認します。Node Package Managerを使用します:

      ```

      npm install newrelic --save

      ```

      2. AWS SDKモジュールをNode.jsエージェントとともにインストールする:

      ```

      npm install @newrelic/aws-sdk --save

      ```

      3. Lambdaコードで、ファイルの先頭でエージェントモジュールとAWS SDKを求め、ハンドラー関数にラップします。 例：

      ```

      const newrelic = require('newrelic');
      require('@newrelic/aws-sdk');

      // Other module loads go under the two require statements above

      module.exports.handler = newrelic.setLambdaHandler((event, context, callback) => {
      // This is your handler function code
      console.log('Lambda executed');
      callback();
      });

      ```

      4. \[TEST]AWS Lambda 向けのサーバーレ[custom events](/docs/using-new-relic/welcome-new-relic/getting-started/glossary#custom-event)AWS Lambda 向けのサーバーレスモニタリ [`recordCustomEvent` API](/docs/agents/nodejs-agent/api-guides/nodejs-agent-api#record_custom_event). 例：

      ```

      module.exports.handler = newrelic.setLambdaHandler((event, context, callback) => {
      newrelic.recordCustomEvent(‘MyEventType’, {foo: ‘bar’});

      console.log('Lambda executed');
      callback();
      });

      ```

      5. Lambda関数とNode.jsエージェントフォルダを一緒に圧縮します。 要件および推奨：

         * New Relicエージェントフォルダに入っていないNew Relicファイルは、含める必要はありません。
         * \[TEST]`lambda_function.node`, のサーバーレスモニタリングは\[TEST]`lambda_function.zip`. レスモニタリングはtarballは使用しないでください。
         * Lambdaと関連モジュールはすべて、zipファイルのルートディレクトリに入っている必要があります。 つまり、ファイルを含むファイルを圧縮するとうまくいきません。

      6. 圧縮したファイルを、AWS Lambdaアカウントにアップロードします。

      7. AWSコンソールで、次の環[境変数を設定](https://docs.aws.amazon.com/lambda/latest/dg/env_variables.html)します：

         * \[TEST]スモニタ`NEW_RELIC_NO_CONFIG_FILE`. Set to `true`リングは
         * \[TEST]`NEW_RELIC_APP_NAME`:向けのサーバーレスモニタリングは
         * \[TEST]`NEW_RELIC_ACCOUNT_ID`. Your [account ID](/docs/accounts/install-new-relic/account-setup/account-id).ニタリングは
         * `NEW_RELIC_TRUSTED_ACCOUNT_KEY`.これは、お客様のアカウント[IDでも](/docs/accounts/install-new-relic/account-setup/account-id)あります。アカウントがサブアカウントの場合、これはroot/親アカウントのアカウントIDである必要があります。

      8. \[TEST]AWS Lambda 向けのサーバーレスモニタ`NEW_RELIC_SERVERLESS_MODE_ENABLED` のサーバーレスモ `true`.（AWS Lambda環境で実行する場合、エージェントはサーバーレスモードで自動的に実行されます。**AWSにおいて実行している場合、この変数を使用しないでください**。）

      9. \[TEST]AWS Lambda 向けのサーバーレスモニタリングは

         * `NEW_RELIC_LOG_ENABLED`を`true`に設定します。
         * CloudWatchについて`NEW_RELIC_LOG`を`stdout`に設定するか、書き込み可能なロケーションに設定します。
         * ログレベルは、デフォルトで`info`に設定されます。その他のログレ[ベルを参照し](/docs/agents/nodejs-agent/installation-configuration/nodejs-agent-configuration#logging_config)てください。

      10. 少なくとも1回Lambdaを呼び出します。 これにより、CloudWatchロググループが作成されます。次のステップを行うには、このグループが必要です。

          ラッパーはLambda実行についてのデータを収集し、JSONメッセージを生成し、CloudWatchログに記録します。次に、[CloudWatchを設定してそのログを](#stream-logs)New Relicに送信します。
    </Collapser>

    <Collapser
      id="python"
      title="Python"
    >
      Python Lambdaをインストゥルメントするには：

      1. Pythonエージェントパッケージをダウンロードし、関数と同じディレクトリに配置します。 この場合、pipを使用します：

      ```

      pip install -t . newrelic

      ```

      <Callout variant="important">
        \[TEST]AWS Lambda 向けのサーバーレスモニタリン`DistutilsOptionError: ーバーレスモ prefix/exec-prefix -- ーバーレスモ`. ングは詳細については、[Homebrew GitHub post](https://github.com/Homebrew/brew/blob/master/docs/Homebrew-and-Python.md#note-on-pip-install---user)をご覧ください。
      </Callout>

      2. Lambdaコードで、Pythonエージェントモジュールをインポートし、New Relicデコレーターを使用してハンドラー関数を修飾します。**最初に、コードでNew Relicパッケージをインポートする必要があります。**次の例を見てみましょう。

      ```

      import newrelic.agent
      newrelic.agent.initialize()
      @newrelic.agent.lambda_handler()
      def handler(event, context):
      ...
      ```

      3. \[TEST]AWS Lambda 向けのサーバーレ[custom events](/docs/using-new-relic/welcome-new-relic/getting-started/glossary#custom-event) 向けのサーバーレスe [`record_custom_event` API](/docs/agents/python-agent/python-agent-api/record_custom_event)は次の例を見てみましょう。

      ```

      @newrelic.agent.lambda_handler()
      def handler(event, context):
      newrelic.agent.record_custom_event('CustomEvent', {'foo': 'bar'})
      …

      ```

      4. このガイドラインを使用して、`lambda_function.py`と`newrelic/`フォルダを一緒に圧縮します：

         * `newrelic/`フォルダに入っていないNew Relicファイルは、含める必要はありません。
         * \[TEST]AWS Lambda 向けのサーバーレスモ `lambda_function.py`,\[TEST]AWS Lambda 向けのサーバーレス`lambda_function.zip`は.tarballは使用しないでください。
         * Lambdaと関連モジュールはすべて、zipファイルのルートディレクトリに入っている必要があります。 つまり、ファイルを含むファイルを圧縮するとうまくいきません。

      5. 圧縮したファイルを、AWS Lambdaアカウントにアップロードします。

      6. AWSコンソールで、次の環境[変数を設定し](https://docs.aws.amazon.com/lambda/latest/dg/env_variables.html)ます：

         * \[TEST]`NEW_RELIC_SERVERLESS_MODE_ENABLED`. サーバーレスモレスモスモ `true`

      7. 次の環境変数はLambdaモニターの機能には不要ですが、Lambda機能をディストリビューティッド（分散）トレーシングに含める場合は必要です。ディストリビューティッ[ド（分散）トレ](/docs/apm/distributed-tracing/getting-started/introduction-distributed-tracing)ーシングを有効にするには、AWSコンソールで次の[環境変](https://docs.aws.amazon.com/amplify/latest/userguide/environment-variables.html)数を設定します。

         * \[TEST]`NEW_RELIC_DISTRIBUTED_TRACING_ENABLED`. レスレスレス
         * \[TEST]`NEW_RELIC_ACCOUNT_ID`. Your [account ID](/docs/accounts/install-new-relic/account-setup/account-id).ニタリングは
         * `NEW_RELIC_TRUSTED_ACCOUNT_KEY.`これは、お客様のアカウント[IDでもあ](/docs/accounts/install-new-relic/account-setup/account-id)ります。アカウントがサブアカウントの場合、これはroot/親アカウントのアカウントIDである必要があります。

      8. \[TEST]AWS Lambda 向けのサー [`NEW_RELIC_LOG` 向け `NEW_RELIC_LOG_LEVEL` 向け向け](/docs/agents/python-agent/configuration/python-agent-configuration#environment-variables)タリングは

      9. 少なくとも1回Lambdaを呼び出します。 これにより、CloudWatchロググループが作成されます。次のステップを行うには、このグループが必要です。

         New RelicデコレーターはLambda実行についてのデータを収集し、JSONメッセージを生成し、CloudWatchログに記録します。次に、[CloudWatchを設定してそのログをNew Relicに送信します。](#stream-logs)
    </Collapser>
  </Collapser>
</CollapserGroup>

## \[TEST]Step 4. 向けのサーバーレスモニタリングは [#stream-logs]

このステップでは、Lambda関数のCloudWatch Logsストリームを、ステップ2で設定した`newrelic-log-ingestion Lambda`に関連付[けます](#connect-aws)。

<Callout variant="important">
  \[TEST]AWS Lambda 向けのサーバーレス [Serverless Framework のサーのサ 3](#serverless-plugin).グは
</Callout>

このステップは、CLIツールまたは手動の手順を使用して行えます。

### CLIツールを使用する [#cli-cloudwatch-stream]

モニターしたい全てのLambda関数に関して、このコマンドを実行します:

```

newrelic-lambda subscriptions install --function FUNCTION*NAME*#1

```

または、すべてのサポートされた関数にサブスクリプションフィルターを設定するには、このコマンドを実行します:

```

newrelic-lambda subscriptions install --function all

```

このコマンドに関する注意点:

* 1つのAWSアカウントおよびリージョンにつき必要となるのは、1つの `newrelic-log-ingestion` Lambdaのみです。これに、好きなだけの関数をサブスクライブできます。
* リージョン指定の引数を含む引数の詳細に関しては、[GitHubドキ](https://github.com/newrelic/newrelic-lambda-cli#install-log-subscription)ュメントをご覧ください。
* CloudWatch検証エラーが送信されます。 これは、データのレポートには影響を与えません。 New Relicでデータレポーティングを確認できた場合は、このエラーメッセージを無視してください。

<Callout variant="important">
  [Log](https://docs.newrelic.com/docs/logs/new-relic-logs/get-started/introduction-new-relic-logs)s を使用していて、（Lambdaログだけでなく）すべてのログデータを当社に送信したい場合は、すべてのログをストリーミングする[を参照し](#stream-all-logs)てください。
</Callout>

### 手動の手順 [#manual-cloudwatch-logs]

[CLIツー](#cli)ルが実行する手動の手順は以下のとおりです:

<Collapser
  id="manual-stream-logs"
  title="[TEST]AWS Lambda 向けのサーバーレスモニタリングは"
>
  [ステップ2で](#connect-aws)は、`newrelic-log-ingestion`Lambda関数を設定します。Lambda関数をインストゥルメントした後（[ステップ3](#instrument-lambda)）、`newrelic-lambda subscriptions`コマンドはその関数のCloudWatch Logsストリームを`newrelic-log-ingestion Lambda`に関連付けます。これを手動で行う：

  1. CloudWatchを開いて左側のメニューでログを選択してから、監視し**ている関**数のロググループを選択します。

  2. **Actions**を選択し、**AWS Lambdaにストリ**ームを選択します。

  3. **Lambda function**の下で、`newrelic-log-ingestion`関数を選択します。

  4. **Log format**を`JSON`に設定します。

  5. \[TEST]けのけの向けの**Subscription filter pattern to** `?REPORT ?NR_LAMBDA_MONITORING ?"Task timed out" ?RequestId`. モニタリングはまたは、`LOGGING_ENABLED`環境変数を使用している場合、すべてのログを[stream all your logs](#stream-all-logs)にストリームし、このフィールドは空欄のままにします。

     この手順に関[するメモおよび補足事項を参](#stream-logs)照してください。

     <Callout variant="important">
       上記のメソッドで選択する`newrelic-log-ingestion` Lambda関数が、Lambda関数と同じAWSリージョンにあることを確認します。
     </Callout>
</Collapser>

## 次のステップ [#find-data]

これらの手順を完了した後、次の操作を実行できます。

* [Lambda モニタリング UI](/docs/lambda-monitoring-ui) のデータレポートをご覧ください。データが見つからない場合は、[「Lambda のトラブルシューティングを有効にする](/docs/serverless-function-monitoring/aws-lambda-monitoring/troubleshooting/troubleshooting-enabling-new-relic-monitoring-aws-lambda)」をご覧ください。
* コンフィ[グレーションの](/docs/serverless-function-monitoring/aws-lambda-monitoring/get-started/configure-monitoring-aws-lambda-new-relic-serverless)設定を使用して、データを微調整します。

<Callout variant="important">
  **当社の`newrelic-log-ingestion`関数は、自動的に更新されません。**最善の結果を得て最新の機能にアクセスするため、当社で[は時々Lambdaモニタリングを更](/docs/serverless-function-monitoring/aws-lambda-monitoring/get-started/update-lambda-monitoring)新することを推奨しています。
</Callout>

## \[TEST]AWS Lambda 向けのサーバーレスモニタリングは [#stream-all-logs]

ロ[グ管理を使用してい](https://docs.newrelic.com/docs/logs/new-relic-logs/get-started/introduction-new-relic-logs)て、すべてのログをNew Relicに報告する場合は、以下の解説**に従っ**てください。

1. `newrelic-log-ingestion` Lambdaに移動し、`LOGGING_ENABLED`環境変数を`true`に設定します

2. 既存のフィルターパターンを修正することはできないため、削除した後で再度追加する必要があります:

   1. サブスクリプ**ションフィルター**パターンを`""`に設定します。モニターの対象となっている各Lambdaの**Log group**に移動し、`newrelic-log-ingestion`サブスクリプションを削除します。
   2. サブ[スクリプションフィルター](https://docs.newrelic.com/docs/serverless-function-monitoring/aws-lambda-monitoring/get-started/enable-new-relic-monitoring-aws-lambda#manual-stream-logs)を再び追加し、**Subscription filter pattern**フィールドは空欄のままにします。

```

```